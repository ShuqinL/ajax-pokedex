<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<!-- 	<link href="style.css" rel="stylesheet" type="text/css" /> -->
		<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css"> -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <style>

    </style>
		<title>AJAX-Pokedex</title>
	</head>
	<body>

      <h3 >Pokedex</h3>
      <select id="pokedex">
      <option value="">Select a Pokemon:</option>
    </select> </br></br>    
    <div id="pokeId"></div>
    <div id="image"></div>
    <div id="moves"></div></br></br> 
    <div id="displayEvolution"></div>

  </select>
    
     <script>
      
      let names=[];
      let urls=[];

      fetch('https://pokeapi.co/api/v2/pokemon/?limit=964')
         .then(function(response) {
           return response.json();
         })
         .then(function(myJson) {     
           let pokemons = myJson.results;
                     
           for(var i = 0; i < 964; i++) {
            let pokemonName = pokemons[i].name;
            names.push(pokemonName);
            let url = pokemons[i].url;
            urls.push(url);
             $("#pokedex").append("<option value=\""+url+"\">" + pokemonName + "</option>");
           } 
         })
         .catch(error => console.error(error));
         
          $("#pokedex").change(function(e) {
             var value = $(this).val();      
             fetch(value)
             .then(function(response) {
                return response.json();
              })

             .then(function(myJson) { 
                //display id
               let ids = myJson.id;
               $("#pokeId").text(ids);  
               //display moves
                let moves = myJson.moves;
                for(let i=0; i<5; i++){
                   move = moves[i];
                  let moveName = move.move.name;
                  $("#moves").append(moveName + "<br/>");
                 }
                //display image   
                let image=myJson.sprites.front_default;     
                fetch(image)
               .then(function(response) {
                  return response;
                 })
               .then(function(myJson) {         
                  $("#image").html("<img src=\""+myJson.url+"\"/>");
                })
               .catch(error => console.error(error));
              
               //display evolution chain
               let species=myJson.species.url;
               fetch(species)
               .then(function(response){
                 return response.json();
               })
               .then(function(data){
                 if(data.evolves_from_species!==null){
                   //display ancestor's name
                  $("#displayEvolution").text(data.evolves_from_species.name);
                  //display ancestor's image             
                  let prevId=names.indexOf(data.evolves_from_species.name);
                  fetch(urls[prevId]) 
                  .then(function(response){
                     return response.json();
                  })
                  .then(function(myJson){
                    $("#displayEvolution").append("</br></br><img src=\""+myJson.sprites.front_default+"\"/>");
                  })
                 } else {
                    $("#displayEvolution").text("No ancestor");
                 }                 
               })
               .catch(error => console.error(error));

              });

           });

        
   
    
    </script>   
    </body>
</html>
